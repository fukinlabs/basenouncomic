# ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå Data Feed ‡πÉ‡∏ô NFTViewClient.tsx

## üî¥ ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà Data Feed ‡∏´‡∏ô‡∏±‡∏Å

### 1. **useEffect (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 37-196) - ‡∏Å‡∏≤‡∏£ Fetch Metadata**

**‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å:**
- ‡∏°‡∏µ‡∏Å‡∏≤‡∏£ fetch `/api/nft-metadata` **‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á** (‡∏≠‡∏≤‡∏à‡∏ñ‡∏∂‡∏á 3 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á):
  1. ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 65: Fetch ‡∏î‡πâ‡∏ß‡∏¢ tokenId
  2. ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 80: Fetch ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ñ‡πâ‡∏≤‡πÄ‡∏à‡∏≠ tokenId ‡∏à‡∏≤‡∏Å FID lookup
  3. ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 86: Retry ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å 500ms delay

**Flow ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏±‡∏ç‡∏´‡∏≤:**
```
1. Fetch /api/nft-metadata?tokenId=X (404)
2. Fetch /api/nft-by-fid?fid=X (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤ tokenId ‡∏à‡∏£‡∏¥‡∏á)
3. Fetch /api/nft-metadata?tokenId=Y (‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á)
4. ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ ‚Üí Retry ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å 500ms
```

**‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:**
- ‚ö†Ô∏è ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
- ‚ö†Ô∏è ‡∏ä‡πâ‡∏≤‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠‡∏´‡∏•‡∏≤‡∏¢ request
- ‚ö†Ô∏è ‡πÉ‡∏ä‡πâ bandwidth ‡∏°‡∏≤‡∏Å

### 2. **‡∏Å‡∏≤‡∏£ Fetch Farcaster User Data**

**‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å:**
- ‡∏°‡∏µ‡∏Å‡∏≤‡∏£ fetch `/api/farcaster-user` **‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á**:
  1. ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 103: ‡πÄ‡∏°‡∏∑‡πà‡∏≠ metadata ‡πÑ‡∏°‡πà‡∏û‡∏ö (‡πÉ‡∏ä‡πâ tokenId ‡πÄ‡∏õ‡πá‡∏ô FID)
  2. ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 165: ‡πÄ‡∏°‡∏∑‡πà‡∏≠ metadata ‡∏û‡∏ö (‡πÉ‡∏ä‡πâ FID ‡∏à‡∏≤‡∏Å metadata)

**‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:**
- ‚ö†Ô∏è ‡∏≠‡∏≤‡∏à‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô
- ‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏°‡∏µ caching

### 3. **‡∏Å‡∏≤‡∏£ Fetch Owner Address**

**‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å:**
- ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 135: Fetch `/api/nft-check?tokenId=...` ‡πÅ‡∏¢‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏≤‡∏Å
- ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ö metadata fetch

**‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:**
- ‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏µ‡∏Å 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
- ‚ö†Ô∏è ‡∏≠‡∏≤‡∏à‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ö metadata fetch ‡πÑ‡∏î‡πâ

## üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô API Calls

**‡∏Å‡∏£‡∏ì‡∏µ‡∏õ‡∏Å‡∏ï‡∏¥ (metadata ‡∏û‡∏ö):**
1. `/api/nft-metadata?tokenId=X` - 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
2. `/api/nft-check?tokenId=X` - 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
3. `/api/farcaster-user?fid=Y` - 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
**‡∏£‡∏ß‡∏°: 3 API calls**

**‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏°‡πà‡∏õ‡∏Å‡∏ï‡∏¥ (metadata ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Üí retry):**
1. `/api/nft-metadata?tokenId=X` - 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á (404)
2. `/api/nft-by-fid?fid=X` - 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
3. `/api/nft-metadata?tokenId=Y` - 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
4. `/api/nft-metadata?tokenId=Y` - 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á (retry)
5. `/api/farcaster-user?fid=X` - 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
**‡∏£‡∏ß‡∏°: 5 API calls**

## ‚úÖ ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### 1. **‡∏•‡∏î‡∏Å‡∏≤‡∏£ Fetch Metadata ‡∏ó‡∏µ‡πà‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô**

**‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:**
- ‡πÄ‡∏Å‡πá‡∏ö flag ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£ fetch ‡∏ã‡πâ‡∏≥
- ‡∏•‡∏ö retry mechanism ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
- ‡πÉ‡∏ä‡πâ tokenId ‡∏à‡∏≤‡∏Å FID lookup ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ

### 2. **‡∏£‡∏ß‡∏° API Calls**

**‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:**
- ‡∏£‡∏ß‡∏° `/api/nft-check` ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö `/api/nft-metadata` response
- ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ Promise.all() ‡πÄ‡∏û‡∏∑‡πà‡∏≠ fetch ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô

### 3. **‡πÄ‡∏û‡∏¥‡πà‡∏° Caching**

**‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:**
- Cache metadata ‡πÅ‡∏•‡∏∞ Farcaster user data
- ‡πÉ‡∏ä‡πâ localStorage ‡∏´‡∏£‡∏∑‡∏≠ sessionStorage

### 4. **Optimize Farcaster User Fetch**

**‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:**
- Fetch Farcaster user ‡πÅ‡∏Ñ‡πà‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
- ‡πÉ‡∏ä‡πâ FID ‡∏à‡∏≤‡∏Å metadata ‡πÅ‡∏ó‡∏ô tokenId

## üéØ Priority ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

1. **‡∏™‡∏π‡∏á**: ‡∏•‡∏î‡∏Å‡∏≤‡∏£ fetch metadata ‡∏ó‡∏µ‡πà‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô (retry mechanism)
2. **‡∏Å‡∏•‡∏≤‡∏á**: ‡∏£‡∏ß‡∏° API calls (nft-check + metadata)
3. **‡∏ï‡πà‡∏≥**: ‡πÄ‡∏û‡∏¥‡πà‡∏° caching

